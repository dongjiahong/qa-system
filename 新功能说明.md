# 新功能说明

## 功能概述

为知识库问答系统添加了两个重要的新功能：

### 1. 避免重复问题
- **功能描述**: 系统会记录已经生成过的问题，避免在同一个会话中重复提出相同的问题
- **实现原理**: 
  - 为每个问题生成内容哈希值（基于知识库名称和问题内容）
  - 在问题生成器中维护问题历史记录
  - 生成新问题时检查是否与历史问题重复

### 2. 跳过问题功能
- **功能描述**: 用户在对某个问题不满意时，可以选择跳过该问题，系统会生成新的问题
- **使用方法**: 在回答问题时输入 `skip` 或 `跳过`

## 使用方法

### 开始问答会话
```bash
knowledge review <知识库名称>
```

### 会话中的新命令
- `skip` 或 `跳过`: 跳过当前问题，生成新问题
- `clear` 或 `清除`: 清除当前会话的问题历史记录
- `quit` 或 `exit` 或 `退出`: 退出会话

### 使用示例
```
开始 'my_kb' 知识库问答会话
输入 'quit' 或 'exit' 退出会话
输入 'skip' 跳过当前问题
输入 'clear' 清除问题历史记录

┌─────────────────────────────────────────────────────────────┐
│                           问题                              │
├─────────────────────────────────────────────────────────────┤
│ 什么是机器学习的主要应用领域？                               │
└─────────────────────────────────────────────────────────────┘
已生成问题数: 1

请输入您的答案 (或输入 'skip' 跳过): skip
已跳过当前问题

==================================================

┌─────────────────────────────────────────────────────────────┐
│                           问题                              │
├─────────────────────────────────────────────────────────────┤
│ 深度学习与传统机器学习有什么区别？                           │
└─────────────────────────────────────────────────────────────┘
已生成问题数: 2

请输入您的答案 (或输入 'skip' 跳过): 深度学习使用神经网络...
```

## 技术实现

### 问题去重机制
1. **哈希生成**: 使用MD5算法对"知识库名称:问题内容"生成哈希值
2. **历史记录**: 在QuestionGenerator中维护每个知识库的问题哈希集合
3. **重复检查**: 生成新问题时检查哈希是否已存在
4. **重试机制**: 如果生成重复问题，会重试生成新问题

### 跳过功能实现
1. **命令识别**: 在CLI中识别用户输入的跳过命令
2. **问题重新生成**: 调用支持去重的问题生成方法
3. **历史管理**: 提供清除历史记录的功能

### 数据模型更新
- `Question`模型新增`content_hash`字段
- 更新序列化和反序列化方法
- 保持向后兼容性

## 配置选项

### 问题生成参数
- `max_attempts`: 生成唯一问题的最大尝试次数（默认5次）
- `allow_duplicates`: 是否允许重复问题（默认False）

### 使用建议
1. **长时间会话**: 如果进行长时间的问答会话，建议定期使用`clear`命令清除历史记录
2. **问题质量**: 如果连续遇到不满意的问题，可以多次使用`skip`命令
3. **知识库大小**: 对于较小的知识库，可能会更快遇到重复问题的情况

## 注意事项

1. **内存使用**: 问题历史记录存储在内存中，重启程序后会清空
2. **哈希冲突**: 虽然概率极低，但理论上存在不同问题产生相同哈希的可能
3. **性能影响**: 对于大量问题的会话，历史记录检查可能会有轻微的性能影响

## 未来改进

1. **持久化存储**: 将问题历史记录保存到数据库，支持跨会话去重
2. **智能去重**: 基于语义相似度而非精确匹配的去重机制
3. **问题质量评估**: 自动评估问题质量，优先生成高质量问题
4. **用户偏好学习**: 根据用户的跳过行为学习偏好，改进问题生成策略